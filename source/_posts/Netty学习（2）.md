title: Netty学习（2）
date: 2018-08-14 16:39:15
categories: 编程
tags: Netty
---
说下I/O多路复用。参考了stevens的《unix网络编程（第二版）》

一个输入操作一般有两个阶段：
1. 等待数据准备好
2. 从内核到进程拷贝数据

<!-- more -->

对于Socket编程，第一步一般是等待数据到达网络，将数据拷贝到内核缓冲区，第二步是将数据从内核缓冲区拷贝到用户空间。

传统的阻塞式I/O, 两个阶段都在等（写代码的时候都没感觉到有两个阶段）。 I/O多路复用，以读数据为例，将整个过程拆分成了两个阶段，首先检查数据有没有准备好，如果数据准备好就开始第二阶段。这么一看，多路复用也没有特别高明的地方，如果连接少，比如只有一个连接，反而会比传统的阻塞式的I/O慢，因为要调两次系统调用。但是，当并发上来的时候，I/O多路复用的优势就显示出来了。

附上书中的两个图：

![](/images/阻塞IO.png)

![](/images/IO多路复用.png)

传统的阻塞式I/O，1000个连接会起1000个线程，每个线程都去检查自己的数据是否准备好了。采用I/O多路复用，只需要1个线程监控这1000个连接。所以说多路复用的复用的是什么，复用了一个线程去监控1000个连接。

好像说到这里多路复用就讲完了。以后再有什么体会，再修改吧。