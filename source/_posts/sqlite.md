title: sqlite是个好东西
date: 2015-02-28 22:28:15
categories: 编程
tags: sqlite
---
sqlite可以看作一个迷你的关系型数据库。很多嵌入式设备都使用了sqlite，比如我们常见的Android、iPhone手机。一些项目不需要或者说没必要专门设置一个数据库服务器，这个时候就可以用sqlite了。

最近一次我用到的sqlite背景是这样的（我做了简化）：<!--more-->

> 大学同学想给别人做个客户端软件，从新浪财经获取股票当天的成交量，然后用程序新建了一个文件比如20150228.txt，文件中每行记录了一个股票代码和它的当日成交量。

然后这个同学想让我帮忙计算5日成交均量、10日成交均量、20日成交均量这样的数据。问题来了，由于他所有的程序都是用C语言实现的，我这一部分也需要采用纯C进行开发。多年的失败经验告诉我，计算X日成交均量没有那么简单，好多问题需要考虑，比如求5日成交均量得确定是哪5天吧（只有工作日才有数据）、要使用C语言解析文件字符串找出对应的成交量吧等等。BTW，我上次写C代码是校招的时候。

由于只是个客户端软件，设计的时候没有单独再使用MySQL、Oracle这样的数据库服务器（如果是IBM干这个活，肯定把自己家的DB2搬过来，然后操作系统给你换成AIX，服务器换成自己的小型机，顺便设计一套巨复杂的流程，然后等着每年收你的钱）。这是一个很好的突破点！

换个思路，干嘛要用文件记录这些数据，这是数据库应该干的事。于是，我想起了sqlite。我在[sqlite官网](http://www.sqlite.org/)上下载了一份它的源文件，只需要sqlite3.c和sqlite3.h这两个文件，太体贴了。最后的方案变成了：

> 1. 在新浪财经获取股票信息，将当天日期、股票代码、当日成交量写到sqlite数据库表中
> 2. 使用类似如下sql语句获取5日成交量
> 
    select avg(当日成交量) from 表名 t where t.stockcode = '股票代码' and t.sdate <= '当前日期' order by sdate desc limit 5

用到的sql语句是点睛之笔，它首先按照日期降序排序，然后根据股票代码获取了最近5天的股票信息，最后利用了标准SQL自带的求平均值的AVG函数求出了5日成交均量。

大功告成。

研究生期间我利用sqlite的特性开发的Android软件也获得了中国移动的一个小奖，以后补充上。

---3月1日更新---

我发现没什么可以细说的，从sqlite 数据库中找到对应的通话记录数据，然后对这些数据进行分析。核心就是这么简单，所有代码1周搞定。我觉得之所以获奖很大程度上是因为利用了AchartEngine 开源组件完成饼图、折线图的绘制，界面做的还行。谁知道呢。

